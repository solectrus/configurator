image: ghcr.io/solectrus/solectrus:develop
depends_on:
  postgresql:
    condition: service_healthy
  influxdb:
    condition: service_healthy
  redis:
    condition: service_healthy
links:
  - postgresql
  - influxdb
  - redis
ports:
  - 3000:3000
environment:
  - APP_HOST
  - FORCE_SSL
  - SECRET_KEY_BASE
  - WEB_CONCURRENCY
  - INSTALLATION_DATE
  - ADMIN_PASSWORD
  - FRAME_ANCESTORS
  - DB_HOST=postgresql
  - DB_PASSWORD=${POSTGRES_PASSWORD}
  - DB_USER=postgres
  - REDIS_URL=redis://redis:6379/1
  - INFLUX_HOST
  - INFLUX_TOKEN=${INFLUX_TOKEN_READ}
  - INFLUX_ORG
  - INFLUX_BUCKET
  - INFLUX_POLL_INTERVAL
  - INFLUX_SENSOR_INVERTER_POWER
  - INFLUX_SENSOR_HOUSE_POWER
  - INFLUX_SENSOR_GRID_IMPORT_POWER
  - INFLUX_SENSOR_GRID_EXPORT_POWER
  - INFLUX_SENSOR_BATTERY_CHARGING_POWER
  - INFLUX_SENSOR_BATTERY_DISCHARGING_POWER
  - INFLUX_SENSOR_BATTERY_SOC
  - INFLUX_SENSOR_WALLBOX_POWER
  - INFLUX_SENSOR_CASE_TEMP
  - INFLUX_SENSOR_INVERTER_POWER_FORECAST
  - INFLUX_SENSOR_SYSTEM_STATUS
  - INFLUX_SENSOR_SYSTEM_STATUS_OK
  - INFLUX_SENSOR_GRID_EXPORT_LIMIT
  - INFLUX_SENSOR_HEATPUMP_POWER
  - INFLUX_EXCLUDE_FROM_HOUSE_POWER
healthcheck:
  test: ['CMD-SHELL', 'nc -z 127.0.0.1 3000 || exit 1']
  interval: 30s
  timeout: 10s
  retries: 5
  start_period: 10s
restart: unless-stopped
logging:
  options:
    max-size: '10m'
    max-file: '3'
